# Makefile para compilação com MinGW e OpenCV (Linkagem Dinâmica)
# Use este Makefile para compilar o projeto.

# Diretórios
SRC_DIR := src
INC_DIR := include
OPENCV_DIR := third_party/opencv

# Target principal
TARGET := ift_image_processor.exe

# Configuração do compilador
CXX := g++
CXXFLAGS := -Wall -Wextra -std=c++17 -O2 -g -I$(INC_DIR) -I$(OPENCV_DIR)/include

# Arquivos fonte
IFT_SOURCES := $(wildcard $(SRC_DIR)/ift/data_structures/*.cpp) \
               $(wildcard $(SRC_DIR)/ift/algorithms/*.cpp) \
               $(wildcard $(SRC_DIR)/utils/*.cpp) \
               $(wildcard $(SRC_DIR)/graph/*.cpp) \
               $(SRC_DIR)/ift/ift_result.cpp \
               $(SRC_DIR)/ift_image_processor.cpp

SOURCES := $(filter-out $(SRC_DIR)/utils/image_to_graph.cpp, $(IFT_SOURCES))
SOURCES := $(filter-out $(SRC_DIR)/utils/utils.cpp, $(SOURCES))


# Flags e bibliotecas do linker
LDFLAGS := -L$(OPENCV_DIR)/x64/mingw/lib \
           -lopencv_core455 \
           -lopencv_imgproc455 \
           -lopencv_imgcodecs455 \
           -lopencv_highgui455

# Regra principal
all: $(TARGET)

# Regra de linkagem
$(TARGET): $(SOURCES)
	$(CXX) $(CXXFLAGS) $^ -o $@ $(LDFLAGS)

# Regra de limpeza
clean:
	del /f $(TARGET) *.o *.exe error_log.txt 2>nul

.PHONY: all clean 